<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood â†’ Music</title>

  <style>
    :root{
      --bg:#0b0b0f;
      --fg:#f2f2f7;
      --muted:#a7a7b3;
      --border:rgba(255,255,255,.10);
      --card:rgba(255,255,255,.02);
      --accent:#e5e7eb;
      --accent2:#94a3b8;
      --shadow: 0 10px 35px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    body{
      margin:0;
      color:var(--fg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(229,231,235,.10), transparent 60%),
        radial-gradient(800px 500px at 85% 30%, rgba(148,163,184,.10), transparent 60%),
        var(--bg);
    }

    .wrap{ width:min(980px, 100%); display:grid; gap:18px; }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
    }
    h1{
      margin:0;
      font-size: clamp(24px, 2.6vw, 36px);
      letter-spacing:-0.02em;
      line-height:1.1;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      font-size:14px;
      max-width:72ch;
      line-height:1.35;
    }

    .pill{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      padding:8px 12px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(255,255,255,.12);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .topbar{
      padding:16px 18px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(135deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    }

    .title{ font-weight:800; letter-spacing:-0.01em; }
    .hint{ color:var(--muted); font-size:12px; }

    .content{ padding:18px; }

    .q{
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      border-radius:14px;
      padding:14px;
      margin-bottom:12px;
    }
    .q label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    button.opt{
      flex:1;
      min-width: 160px;
      text-align:left;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color:var(--fg);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
    }
    button.opt:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
    }
    button.opt.selected{
      border-color: rgba(255,255,255,.35);
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      padding:12px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:-0.01em;
    }
    .primary{
      color:#0b0b0f;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
    }
    .ghost{
      background: transparent;
      color: var(--fg);
      border:1px solid var(--border);
    }
    .small{ padding:10px 12px; font-size:13px; }

    .status{
      margin-top:10px;
      color: var(--muted);
      font-size:12px;
      min-height: 18px;
      line-height:1.35;
    }

    .results{ display:grid; gap:12px; }

    .track{
      display:grid;
      grid-template-columns: 62px 1fr auto;
      gap:12px;
      align-items:center;
      padding:12px;
      border:1px solid var(--border);
      border-radius:16px;
      background: rgba(0,0,0,.22);
    }

    .cover{
      width:62px;height:62px;border-radius:14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .cover img{ width:100%; height:100%; object-fit:cover; display:block; }

    .meta .name{ font-weight:900; letter-spacing:-0.01em; }
    .meta .artist{ color:var(--muted); font-size:13px; margin-top:2px; }
    .meta .tag{ color: var(--muted); font-size:12px; margin-top:6px; }

    .meta .why{
      margin-top:8px;
      font-size:12px;
      line-height:1.35;
      color: rgba(242,242,247,.92);
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
    }

    .badgeRow{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:8px;
    }
    .badge{
      font-size:11px;
      color: rgba(242,242,247,.9);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding:4px 8px;
      border-radius:999px;
    }

    .link{
      color: var(--fg);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:12px;
      background: rgba(255,255,255,.03);
      text-decoration:none;
      font-size:13px;
      white-space:nowrap;
    }
    .link:hover{ border-color: rgba(255,255,255,.22); }

    .footerNote{
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      padding:2px 6px;
      border-radius:8px;
      color: var(--fg);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>VibeMatchğŸ§ğŸµ</h1>
        <p class="sub">
          
        </p>
      </div>

      <div class="pill" title="Colori e vibe cambiano in base al mood">
        <span class="dot"></span>
        <span id="moodLabel">mood: neutral ğŸ–¤</span>
      </div>
    </header>

    <div class="grid">
      <!-- QUIZ -->
      <section class="card">
        <div class="topbar">
          <div>
            <div class="title">Quiz rapido âœ¨</div>
            <div class="hint">Scegli una risposta per ogni domanda</div>
          </div>
          <button class="btn ghost small" id="resetBtn">Reset</button>
        </div>

        <div class="content" id="quiz">
          <div class="q">
            <label>1) Come ti senti oggi? ğŸ’­</label>
            <div class="row">
              <button class="opt" data-e="0" data-v="-3">GiÃ¹ di morale ğŸ˜”</button>
              <button class="opt" data-e="0" data-v="-2">Un poâ€™ malinconica/o ğŸŒ§ï¸</button>
              <button class="opt" data-e="1" data-v="-1">Nervosa/o / tesa/o ğŸ˜–</button>
              <button class="opt" data-e="0" data-v="0">Normale ğŸ˜</button>
              <button class="opt" data-e="1" data-v="2">Serena/o ğŸ™‚</button>
              <button class="opt" data-e="2" data-v="3">Gasata/o / felice ğŸ˜„âœ¨</button>
            </div>
          </div>

          <div class="q">
            <label>2) Quanta energia hai in questo momento? âš¡</label>
            <div class="row">
              <button class="opt" data-e="-3" data-v="0">Zero forze ğŸ˜®â€ğŸ’¨</button>
              <button class="opt" data-e="-2" data-v="0">Stanca/o ğŸ’¤</button>
              <button class="opt" data-e="-1" data-v="1">Calma/o ğŸŒ¿</button>
              <button class="opt" data-e="0" data-v="0">Ok / stabile âš–ï¸</button>
              <button class="opt" data-e="2" data-v="1">Carica/o ğŸ”¥</button>
              <button class="opt" data-e="3" data-v="2">A mille ğŸš€</button>
            </div>
          </div>

          <div class="q">
            <label>3) Cosa ti serve adesso? ğŸ¯</label>
            <div class="row">
              <button class="opt" data-e="-2" data-v="1">Calma ğŸ«¶</button>
              <button class="opt" data-e="0" data-v="1">Conforto ğŸ¤</button>
              <button class="opt" data-e="0" data-v="0">Focus ğŸ§ </button>
              <button class="opt" data-e="2" data-v="1">Motivazione ğŸ’ª</button>
              <button class="opt" data-e="2" data-v="-1">Sfogarmi ğŸ˜¤</button>
              <button class="opt" data-e="3" data-v="2">Festa ğŸ‰</button>
            </div>
          </div>

          <div class="q">
            <label>4) Che vibe vuoi intorno? ğŸŒˆ</label>
            <div class="row">
              <button class="opt" data-e="-1" data-v="-1">Intima ğŸ•¯ï¸</button>
              <button class="opt" data-e="-1" data-v="1">Sognante â˜ï¸</button>
              <button class="opt" data-e="0" data-v="1">Leggera ğŸŒ¤ï¸</button>
              <button class="opt" data-e="1" data-v="2">Solare â˜€ï¸</button>
              <button class="opt" data-e="2" data-v="2">Energica âš¡</button>
              <button class="opt" data-e="3" data-v="2">Party mode ğŸª©</button>
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" id="goBtn">Consigliami ğŸ§</button>
            <button class="btn ghost" id="randomBtn">Sono indecisÉ™ â†’ random ğŸ²</button>
          </div>

          <div class="status" id="status"></div>

          <p class="footerNote">
            Copertine via iTunes Search API. Se non compaiono, apri con:
            <span class="kbd">python -m http.server 8000</span>
          </p>
        </div>
      </section>

      <!-- RISULTATI -->
      <section class="card">
        <div class="topbar">
          <div>
            <div class="title">Suggerimenti ğŸ¶</div>
            <div class="hint">4 tracce + copertina + motivazione</div>
          </div>
          <button class="btn ghost small" id="regenBtn" disabled>Stesso mood â†’ nuove scelte ğŸ”</button>
        </div>

        <div class="content">
          <div class="results" id="results">
            <div class="footerNote">
              Compila il quiz e premi <span class="kbd">Consigliami</span>.
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="footerNote">
      Tip per il report: trasformi risposte soggettive in dati (energia/valenza) e aumenti trasparenza con il â€œperchÃ©â€.
    </div>
  </div>

<script>
  // ===== THEME =====
  const MOOD_THEME = {
    hype:    { accent:"#f59e0b", accent2:"#ef4444", label:"hype ğŸ”¥" },
    rage:    { accent:"#ef4444", accent2:"#a855f7", label:"rage âš¡" },
    chill:   { accent:"#22c55e", accent2:"#06b6d4", label:"chill ğŸŒ¿" },
    blue:    { accent:"#3b82f6", accent2:"#a855f7", label:"blue ğŸŒ™" },
    neutral: { accent:"#e5e7eb", accent2:"#94a3b8", label:"neutral ğŸ–¤" }
  };

  function hexToRgba(hex, a){
    const h = hex.replace("#","").trim();
    const bigint = parseInt(h.length === 3 ? h.split("").map(x=>x+x).join("") : h, 16);
    const r = (bigint >> 16) & 255;
    const g = (bigint >> 8) & 255;
    const b = bigint & 255;
    return `rgba(${r},${g},${b},${a})`;
  }

  function setTheme(moodId){
    const t = MOOD_THEME[moodId] || MOOD_THEME.neutral;
    document.documentElement.style.setProperty("--accent", t.accent);
    document.documentElement.style.setProperty("--accent2", t.accent2);
    document.getElementById("moodLabel").textContent = "mood: " + t.label;

    document.body.style.background =
      `radial-gradient(900px 500px at 15% 10%, ${hexToRgba(t.accent, 0.22)}, transparent 60%),
       radial-gradient(800px 500px at 85% 30%, ${hexToRgba(t.accent2, 0.16)}, transparent 60%),
       var(--bg)`;
  }

  // ===== SEEDS (curate) =====
  const MOOD_SEEDS = {
    hype: [
      { q:"Blinding Lights The Weeknd", tags:["pop","moderna","hit"] },
      { q:"Dance The Night Dua Lipa", tags:["pop","virale","party"] },
      { q:"As It Was Harry Styles", tags:["pop","moderna","hit"] },
      { q:"Uptown Funk Mark Ronson Bruno Mars", tags:["pop","funk","party"] },
      { q:"Italodisco The Kolors", tags:["italiano","party","virale"] },
      { q:"Danza Kuduro Don Omar", tags:["latino","classico","festa"] },
      { q:"Titi Me Pregunto Bad Bunny", tags:["latino","moderna","virale"] },
      { q:"Levitating Dua Lipa", tags:["pop","dance","energia"] }
    ],
    rage: [
      { q:"Seven Nation Army The White Stripes", tags:["rock","classico","carica"] },
      { q:"Smells Like Teen Spirit Nirvana", tags:["rock","storico","sfogo"] },
      { q:"HUMBLE Kendrick Lamar", tags:["rap","hit","grinta"] },
      { q:"bad guy Billie Eilish", tags:["pop","dark","virale"] },
      { q:"Killing In The Name Rage Against The Machine", tags:["rock","ribellione","catarsi"] },
      { q:"Superclassico Ernia", tags:["italiano","rap","sfogo"] },
      { q:"Believer Imagine Dragons", tags:["pop rock","energia","motivazione"] },
      { q:"DNA Kendrick Lamar", tags:["rap","intenso","focus"] }
    ],
    chill: [
      { q:"Riptide Vance Joy", tags:["indie","leggera","comfort"] },
      { q:"Sunflower Post Malone", tags:["pop","chill","moderna"] },
      { q:"Dreams Fleetwood Mac", tags:["classico","soft","vibe"] },
      { q:"Golden Hour JVKE", tags:["virale","soft","romantica"] },
      { q:"Banana Pancakes Jack Johnson", tags:["acustica","calma","indie"] },
      { q:"Estate Calcutta", tags:["italiano","indie","chill"] },
      { q:"Corazon Sin Cara Prince Royce", tags:["latino","romantica","calma"] },
      { q:"Put Your Records On Corinne Bailey Rae", tags:["soul pop","serena","comfort"] }
    ],
    blue: [
      { q:"Someone Like You Adele", tags:["ballad","emotiva","iconica"] },
      { q:"Hallelujah Jeff Buckley", tags:["classico","intimo","emotivo"] },
      { q:"The Night We Met Lord Huron", tags:["indie","nostalgia","cinematic"] },
      { q:"drivers license Olivia Rodrigo", tags:["pop","emotiva","moderna"] },
      { q:"Skinny Love Bon Iver", tags:["indie","fragile","intimo"] },
      { q:"Fix You Coldplay", tags:["pop rock","conforto","classico"] },
      { q:"Sally Vasco Rossi", tags:["italiano","rock","emotivo"] },
      { q:"E penso a te Lucio Battisti", tags:["italiano","storico"] }
    ],
    neutral: [
      { q:"Africa Toto", tags:["classico","feel good","comfort"] },
      { q:"Feel Good Inc Gorillaz", tags:["indie pop","cool","mid"] },
      { q:"Clocks Coldplay", tags:["pop rock","classico","equilibrio"] },
      { q:"Take On Me a-ha", tags:["classic pop","energia","nostalgia"] },
      { q:"Vivir Mi Vida Marc Anthony", tags:["latino","positivo","steady"] },
      { q:"Watermelon Sugar Harry Styles", tags:["pop","leggera","hit"] },
      { q:"Counting Stars OneRepublic", tags:["pop","motivazionale","mid"] },
      { q:"Volare Domenico Modugno", tags:["italiano","storico"] },
    ]
  };

  // ===== UI refs =====
  const quizEl    = document.getElementById("quiz");
  const resultsEl = document.getElementById("results");
  const statusEl  = document.getElementById("status");
  const goBtn     = document.getElementById("goBtn");
  const resetBtn  = document.getElementById("resetBtn");
  const randomBtn = document.getElementById("randomBtn");
  const regenBtn  = document.getElementById("regenBtn");

  let lastMoodId = null;
  let lastInfo = null;

  // ===== selection behavior =====
  quizEl.addEventListener("click", (e) => {
    const btn = e.target.closest("button.opt");
    if(!btn) return;
    const qBox = btn.closest(".q");
    const all = qBox.querySelectorAll("button.opt");
    all.forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
    statusEl.textContent = "";
  });

  function pickRandom(arr, n){
    const copy = [...arr];
    const out = [];
    while(out.length < n && copy.length){
      const i = Math.floor(Math.random()*copy.length);
      out.push(copy.splice(i,1)[0]);
    }
    return out;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  // ===== read quiz scores =====
  function readScores(){
    let energy = 0;
    let valence = 0;
    let count = 0;

    document.querySelectorAll(".q").forEach(q => {
      const sel = q.querySelector("button.opt.selected");
      if(!sel) return;
      energy += Number(sel.dataset.e || 0);
      valence += Number(sel.dataset.v || 0);
      count++;
    });

    if(count < 4) return null;
    return { energy, valence };
  }

  // ===== mood mapping =====
  function computeMood(scores){
    const e = Math.max(-6, Math.min(6, scores.energy));
    const v = Math.max(-6, Math.min(6, scores.valence));

    let moodId = "neutral";
    if(e >= 2 && v >= 2) moodId = "hype";
    else if(e >= 2 && v <= -1) moodId = "rage";
    else if(e <= -2 && v >= 1) moodId = "chill";
    else if(e <= -2 && v <= -1) moodId = "blue";
    else moodId = "neutral";

    return { moodId, energy:e, valence:v };
  }

  // ===== explanation =====
  function energyLabel(e){
    if(e >= 4) return "altissima ğŸš€";
    if(e >= 2) return "alta ğŸ”¥";
    if(e <= -4) return "bassissima ğŸ˜®â€ğŸ’¨";
    if(e <= -2) return "bassa ğŸ’¤";
    return "media âš–ï¸";
  }
  function valenceLabel(v){
    if(v >= 4) return "super positiva ğŸ˜„";
    if(v >= 2) return "positiva ğŸ™‚";
    if(v <= -4) return "molto pesante ğŸ˜”";
    if(v <= -2) return "nostalgica ğŸŒ§ï¸";
    if(v <= -1) return "tesa ğŸ˜–";
    return "neutra ğŸ˜";
  }
  function moodIntent(moodId){
    return {
      hype: "ti serve energia + good vibes per muoverti ğŸª©",
      rage: "ti serve scaricare senza esplodere ğŸ˜¤",
      chill: "ti serve calma ma con un filo di luce ğŸŒ¿",
      blue: "ti serve compagnia delicata, niente rumore ğŸŒ™",
      neutral: "ti serve equilibrio, senza esagerare ğŸ–¤"
    }[moodId] || "ti serve qualcosa in linea";
  }
  function buildWhy(info, tags){
    const eTxt = energyLabel(info.energy);
    const vTxt = valenceLabel(info.valence);
    const tagTxt = (tags?.length ? tags.join(" Â· ") : "vibe");
    return `PerchÃ©: oggi hai energia ${eTxt} e un tono ${vTxt} â†’ ${moodIntent(info.moodId)}. Questa traccia Ã¨ ${tagTxt}, quindi matcha bene.`;
  }

  function makeBadgesFromTags(tags){
    const badges = [];
    const lower = (tags || []).map(t => String(t).toLowerCase());

    if(lower.some(t=>t.includes("indie"))) badges.push("indie ğŸŒ±");
    if(lower.some(t=>t.includes("rock"))) badges.push("rock ğŸ¸");
    if(lower.some(t=>t.includes("pop"))) badges.push("pop âœ¨");
    if(lower.some(t=>t.includes("latino"))) badges.push("latino ğŸ’ƒ");
    if(lower.some(t=>t.includes("classico") || t.includes("classic") || t.includes("storico"))) badges.push("classic ğŸ•°ï¸");
    if(lower.some(t=>t.includes("virale") || t.includes("hit"))) badges.push("viral / hit ğŸ“ˆ");
    if(lower.some(t=>t.includes("premiata") || t.includes("award") )) badges.push("award ğŸ†");

    return badges.slice(0,3);
  }

  // ===== iTunes lookup =====
  async function fetchTrackFromITunes(query){
    const url = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=1`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("iTunes fetch failed");
    const data = await res.json();
    if(!data.results || data.results.length === 0) return null;

    const r = data.results[0];
    const cover = (r.artworkUrl100 || "").replace("100x100", "300x300");
    return {
      name: r.trackName,
      artist: r.artistName,
      cover,
      link: r.trackViewUrl
    };
  }

  function renderLoading(){
    resultsEl.innerHTML = `<div class="footerNote">Sto cercando le tracceâ€¦ â³ğŸ¶</div>`;
  }

  function renderTracks(tracks){
    resultsEl.innerHTML = "";
    tracks.forEach(t => {
      const div = document.createElement("div");
      div.className = "track";
      div.innerHTML = `
        <div class="cover">
          ${t.cover ? `<img src="${t.cover}" alt="cover">` : ""}
        </div>
        <div class="meta">
          <div class="name">${escapeHtml(t.name || "Titolo sconosciuto")}</div>
          <div class="artist">${escapeHtml(t.artist || "Artista sconosciuto")}</div>
          <div class="tag">${escapeHtml(t.tagsLine || "")}</div>
          <div class="badgeRow">
            ${(t.badges || []).map(b => `<span class="badge">${escapeHtml(b)}</span>`).join("")}
          </div>
          <div class="why">${escapeHtml(t.why || "")}</div>
        </div>
        ${t.link ? `<a class="link" href="${t.link}" target="_blank" rel="noreferrer">Apri</a>` : `<span class="hint">â€”</span>`}
      `;
      resultsEl.appendChild(div);
    });
  }

  // ===== recommendation (4 songs!) =====
  async function recommendFromMood(moodId, info){
    const seeds = MOOD_SEEDS[moodId] || MOOD_SEEDS.neutral;
    const picks = pickRandom(seeds, 4); // âœ… 4 CANZONI

    const tracks = [];
    for(const p of picks){
      const why = buildWhy(info, p.tags);
      const tagsLine = p.tags?.length ? p.tags.join(" Â· ") : "";
      const badges = makeBadgesFromTags(p.tags);

      try{
        const t = await fetchTrackFromITunes(p.q);
        if(t){
          tracks.push({ ...t, why, tagsLine, badges });
        } else {
          tracks.push({ name: p.q, artist:"", cover:"", link:"", why, tagsLine, badges });
        }
      }catch{
        tracks.push({ name: p.q, artist:"", cover:"", link:"", why, tagsLine, badges });
      }
    }
    return tracks;
  }

  // ===== actions =====
  async function run(){
    const scores = readScores();
    if(!scores){
      statusEl.textContent = "Rispondi a tutte le domande ğŸ˜Œ (sono 4, veloci veloci).";
      return;
    }

    const info = computeMood(scores);
    lastMoodId = info.moodId;
    lastInfo = info;

    setTheme(info.moodId);
    statusEl.textContent = `Ok: energia ${info.energy} Â· tono ${info.valence} â†’ vibe ${MOOD_THEME[info.moodId].label}`;

    renderLoading();
    const tracks = await recommendFromMood(info.moodId, info);
    renderTracks(tracks);

    regenBtn.disabled = false;
  }

  async function rerunSameMood(){
    if(!lastMoodId || !lastInfo) return;
    statusEl.textContent = `Stesso mood (${MOOD_THEME[lastMoodId].label}) â†’ nuove scelte ğŸ”`;
    renderLoading();
    const tracks = await recommendFromMood(lastMoodId, lastInfo);
    renderTracks(tracks);
  }

  function resetAll(){
    document.querySelectorAll("button.opt.selected").forEach(b => b.classList.remove("selected"));
    resultsEl.innerHTML = `<div class="footerNote">Compila il quiz e premi <span class="kbd">Consigliami</span>.</div>`;
    statusEl.textContent = "";
    lastMoodId = null;
    lastInfo = null;
    setTheme("neutral");
    regenBtn.disabled = true;
  }

  function randomFill(){
    document.querySelectorAll(".q").forEach(q => {
      const opts = [...q.querySelectorAll("button.opt")];
      opts.forEach(o => o.classList.remove("selected"));
      const pick = opts[Math.floor(Math.random()*opts.length)];
      pick.classList.add("selected");
    });
    statusEl.textContent = "Ok, scelgo io ğŸ² Ora premi Consigliami ğŸ§";
  }

  document.getElementById("goBtn").addEventListener("click", run);
  document.getElementById("resetBtn").addEventListener("click", resetAll);
  document.getElementById("randomBtn").addEventListener("click", randomFill);
  document.getElementById("regenBtn").addEventListener("click", rerunSameMood);

  // init
  setTheme("neutral");
</script>
</body>
</html>
